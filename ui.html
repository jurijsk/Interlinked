<p>Link to current file</p>
<input 
	id="link" type="text"
	placeholder="Example: https://www.figma.com/file/dw0PrDLzdkwtoowagrv3AI/Interlinked?type=design&node-id=0-1&t=hrYZPbIJyT7S8u7N-0">
<p id="linkStatus" style="display: none;">Interlinked</p>
<br />
<label for="createPresentation">Interlink for Presentation mode</label>
<input type="checkbox" checked id="createPresentation" />
<button id="save">Inerlink</button>
<button id="cancel">Cancel</button>


<button class='button button--primary'>Label</button> 
<button class='button button--primary-destructive'>Label</button>
<button class='button button--primary' disabled>Label</button> 

<!-- Secondary -->
<button class='button button--secondary'>Label</button>
<button class='button button--secondary-destructive'>Label</button>
<button class='button button--secondary' disabled>Label</button>

<!-- Tertirary (Hyperlink style button) -->
<button class='button button--tertiary'>Label</button>
<button class='button button--tertiary-destructive'>Label</button>
<button class='button button--tertiary' disabled>Label</button>


<style>
	input[type=text] {
		width: 100%;
	}
</style>

<script type="module">

	console.log(window);

	function getFileKey(url) {
		if (!url) {
			return null;
		}
		const figmaLinkPrefix = "www.figma.com/file/";
		let s = url.indexOf(figmaLinkPrefix);
		if (s == -1) {
			return null;
		}
		s += figmaLinkPrefix.length;
		let e = url.indexOf("/", s);
		let key = url.substring(s, e);
		return key;
	}

	let fileKey = '';
	function onLinkChanged(ev) {
		let protocol = 'https://';
		if(link.value.startsWith(protocol)){
			link.value = link.value.substring(protocol.length);
		}

		let key = getFileKey(link.value);
		let linkStatus = document.getElementById("linkStatus");
		if(!key){
			linkStatus.innerText = "Enter Figma file link";
		} else {
			linkStatus.innerText = `Figma Key '${key}'. Interlinked.`;
		}
		linkStatus.style.removeProperty("display");
		fileKey = key || '';
	}
	let link = document.getElementById('link');
	link.addEventListener("change", onLinkChanged);
	let saveBtn = document.getElementById('save');

	saveBtn.onclick = () => {
		parent.postMessage({ pluginMessage: { type: 'save_n_interlink', fileKey } }, '*')
	}

	document.getElementById('cancel').onclick = () => {
		parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
	}

</script>